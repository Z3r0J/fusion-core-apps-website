---
import "@/styles/global.css";

import GooglePlayLogo from "@/assets/gplay-logo.svg";
import Logo from "@/assets/logo.svg";
import ThemeToggle from "@/components/ThemeToggle.tsx";
import { ClientRouter } from "astro:transitions";
import { Menu } from "lucide-react";

const {
	title = "FusionCore Apps â€” Premium Mobile Applications",
	description = "Professional mobile app development studio delivering secure, innovative, and user-friendly applications for Android and iOS platforms. Transform your ideas into powerful digital experiences.",
	ogImage = "/og-default.jpg",
	canonical,
	noindex = false,
	bodyClass = "",
	showHero = false,
} = Astro.props;

const year = new Date().getFullYear();
const currentPath = Astro.url.pathname;
---

<!doctype html>
<html class="scroll-smooth" lang="en">
	<head>
		<meta charset="utf-8" />
		<meta content="width=device-width, initial-scale=1, viewport-fit=cover" name="viewport" />
		<title>{title}</title>
		<meta content={description} name="description" />
		<meta content={noindex ? "noindex,nofollow" : "index,follow"} name="robots" />
		<link href={canonical ?? new URL(Astro.url.pathname, Astro.site).href} rel="canonical" />

		<meta content="website" property="og:type" />
		<meta content={new URL(Astro.url.pathname, Astro.site).href} property="og:url" />
		<meta content={title} property="og:title" />
		<meta content={description} property="og:description" />
		<meta content={new URL(ogImage, Astro.site).href} property="og:image" />
		<meta content="FusionCore Apps" property="og:site_name" />

		<meta content="summary_large_image" name="twitter:card" />
		<meta content={new URL(Astro.url.pathname, Astro.site).href} name="twitter:url" />
		<meta content={title} name="twitter:title" />
		<meta content={description} name="twitter:description" />
		<meta content={new URL(ogImage, Astro.site).href} name="twitter:image" />

		<meta content="#3d6a45" name="theme-color" />
		<meta content="light dark" name="color-scheme" />
		<meta content="yes" name="apple-mobile-web-app-capable" />
		<meta content="default" name="apple-mobile-web-app-status-bar-style" />

		<link href="/favicon.svg" rel="icon" type="image/svg+xml" />
		<link href="/favicon.svg" rel="apple-touch-icon" />

		<script is:inline type="application/ld+json">
			{
				"@context": "https://schema.org",
				"@type": "Organization",
				"name": "FusionCore Apps",
				"description": "Professional mobile app development studio",
				"url": "https://fusioncore.app",
				"logo": "https://fusioncore.app/logo.svg",
				"foundingDate": "2024",
				"sameAs": ["https://play.google.com/store/apps/developer?id=FusionCore+Apps"]
			}
		</script>

		<script is:inline>
			(function () {
				const stored = localStorage.getItem("theme");
				const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
				const isDark = stored === "dark" || (!stored && prefersDark);

				if (isDark) {
					document.documentElement.classList.add("dark");
				}
			})();
		</script>
		<ClientRouter />
	</head>

	<body class:list={[`min-h-screen antialiased`, `${bodyClass}`]}>
		<!-- Skip to content link for accessibility -->
		<a
			class="button button--primary sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50"
			href="#main"
		>
			Skip to main content
		</a>

		<!-- Header -->
		<header
			class="header sticky top-0 z-40 border-b border-gray-200/50 bg-white/80 backdrop-blur-lg dark:border-gray-800/50 dark:bg-gray-950/80"
		>
			<nav
				aria-label="Main navigation"
				class="header__nav mx-auto flex max-w-7xl items-center justify-between py-4"
				role="navigation"
			>
				<!-- Logo -->
				<a
					class="header__logo hover:text-brand-600 dark:hover:text-brand-400 group flex items-center gap-3 text-xl font-bold text-gray-900 transition-colors dark:text-white"
					href="/"
				>
					<div
						class="from-brand-500 to-brand-600 flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br shadow-lg transition-all duration-200 group-hover:scale-105 group-hover:shadow-xl"
					>
						<Logo class="from-brand-500 to-brand-600 h-6 w-6" />
					</div>
					<span class="gradient-text">FusionCore Apps</span>
				</a>

				<!-- Desktop Navigation -->
				<ul class="header__nav-links hidden items-center gap-8 md:flex" role="menubar">
					<li role="none">
						<a
							class:list={[`nav-link`, { "nav-link--active": currentPath.startsWith("/apps") }]}
							href="/apps"
							role="menuitem"
						>
							Apps
						</a>
					</li>
					<li role="none">
						<a
							class:list={[`nav-link`, { "nav-link--active": currentPath === "/privacy" }]}
							href="/privacy"
							role="menuitem"
						>
							Privacy
						</a>
					</li>
					<li role="none">
						<a
							class:list={[`nav-link`, { "nav-link--active": currentPath === "/contact" }]}
							href="/contact"
							role="menuitem"
						>
							Contact
						</a>
					</li>
				</ul>

				<!-- Theme Toggle & Mobile Menu -->
				<div class="header__actions flex items-center gap-3">
					<ThemeToggle client:load />

					<!-- Mobile menu button -->
					<button
						aria-label="Open mobile menu"
						class="hover:text-brand-600 dark:hover:text-brand-400 focus:ring-brand-500 inline-flex h-10 w-10 items-center justify-center rounded-xl bg-gray-100 text-gray-600 transition-all duration-200 hover:bg-gray-200 focus:ring-2 focus:outline-none md:hidden dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700"
						id="mobile-menu-button"
					>
						<Menu className="h-5 w-5" stroke="currentColor" />
					</button>
				</div>
			</nav>

			<!-- Mobile Navigation Menu -->
			<div
				class="header__mobile-menu hidden border-t border-gray-200 md:hidden dark:border-gray-800"
				id="mobile-menu"
			>
				<nav aria-label="Mobile navigation" class="px-4 py-4" role="navigation">
					<ul class="space-y-4" role="menubar">
						<li role="none">
							<a
								class:list={[
									`block rounded-xl px-4 py-2 text-gray-900 transition-colors hover:bg-gray-100 dark:text-gray-100 dark:hover:bg-gray-800`,
									{
										"bg-brand-50 dark:bg-brand-900/20 text-brand-600 dark:text-brand-400":
											currentPath.startsWith("/apps"),
									},
								]}
								href="/apps"
								role="menuitem"
							>
								Apps
							</a>
						</li>
						<li role="none">
							<a
								class:list={[
									`block rounded-xl px-4 py-2 text-gray-900 transition-colors hover:bg-gray-100 dark:text-gray-100 dark:hover:bg-gray-800`,
									{
										"bg-brand-50 dark:bg-brand-900/20 text-brand-600 dark:text-brand-400":
											currentPath === "/privacy",
									},
								]}
								href="/privacy"
								role="menuitem"
							>
								Privacy
							</a>
						</li>
						<li role="none">
							<a
								class:list={[
									`block rounded-xl px-4 py-2 text-gray-900 transition-colors hover:bg-gray-100 dark:text-gray-100 dark:hover:bg-gray-800`,
									{
										"bg-brand-50 dark:bg-brand-900/20 text-brand-600 dark:text-brand-400":
											currentPath === "/contact",
									},
								]}
								href="/contact"
								role="menuitem"
							>
								Contact
							</a>
						</li>
						<li role="none">
							<a
								class:list={[
									`block rounded-xl px-4 py-2 text-gray-900 transition-colors hover:bg-gray-100 dark:text-gray-100 dark:hover:bg-gray-800`,
									{
										"bg-brand-50 dark:bg-brand-900/20 text-brand-600 dark:text-brand-400":
											currentPath.startsWith("/admin"),
									},
								]}
								href="/admin"
								role="menuitem"
							>
								Admin Panel
							</a>
						</li>
					</ul>
				</nav>
			</div>
		</header>

		<!-- Main Content -->
		<main class="main flex-1" id="main" role="main">
			{
				showHero && (
					<section class="hero gradient-bg py-24 sm:py-32">
						<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
							<slot name="hero" />
						</div>
					</section>
				)
			}

			<div class:list={{ "py-16 sm:py-24": showHero, "py-8 sm:py-12": !showHero }}>
				<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
					<slot />
				</div>
			</div>
		</main>

		<!-- Footer -->
		<footer
			class="footer border-t border-gray-200 bg-gray-50 dark:border-gray-800 dark:bg-gray-900/50"
			role="contentinfo"
		>
			<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
				<!-- Main footer content -->
				<div class="footer__content grid gap-8 py-12 md:grid-cols-4">
					<!-- Company info -->
					<div class="footer__section md:col-span-2">
						<a class="footer__logo mb-4 flex items-center gap-3" href="/">
							<div
								class="from-brand-500 to-brand-600 flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br"
							>
								<Logo class="from-brand-500 to-brand-600 h-5 w-5" />
							</div>
							<span class="text-lg font-bold text-gray-900 dark:text-white">FusionCore Apps</span>
						</a>
						<p class="footer__description mb-6 max-w-md text-gray-600 dark:text-gray-400">
							Professional mobile app development studio delivering secure, innovative, and
							user-friendly applications. Transform your ideas into powerful digital experiences.
						</p>
						<div class="footer__social flex items-center gap-4">
							<a
								aria-label="Visit our Google Play Store"
								class="hover:text-brand-600 dark:hover:text-brand-400 text-gray-400 transition-colors"
								href="https://play.google.com/store/apps/developer?id=FusionCore+Apps"
								rel="noopener noreferrer"
								target="_blank"
							>
								<GooglePlayLogo class="h-6 w-6" />
							</a>
						</div>
					</div>

					<!-- Quick links -->
					<div class="footer__section">
						<h3 class="footer__title mb-4 font-semibold text-gray-900 dark:text-white">
							Quick links
						</h3>
						<ul class="footer__links space-y-3">
							<li>
								<a
									class="hover:text-brand-600 dark:hover:text-brand-400 text-gray-600 transition-colors dark:text-gray-400"
									href="/apps">All apps</a
								>
							</li>
							<li>
								<a
									class="hover:text-brand-600 dark:hover:text-brand-400 text-gray-600 transition-colors dark:text-gray-400"
									href="/privacy">Privacy policy</a
								>
							</li>
							<li>
								<a
									class="hover:text-brand-600 dark:hover:text-brand-400 text-gray-600 transition-colors dark:text-gray-400"
									href="/contact">Contact us</a
								>
							</li>
						</ul>
					</div>

					<!-- Support -->
					<div class="footer__section">
						<h3 class="footer__title mb-4 font-semibold text-gray-900 dark:text-white">Support</h3>
						<ul class="footer__links space-y-3">
							<li>
								<a
									class="hover:text-brand-600 dark:hover:text-brand-400 text-gray-600 transition-colors dark:text-gray-400"
									href="/contact">Help center</a
								>
							</li>
							<li>
								<a
									class="hover:text-brand-600 dark:hover:text-brand-400 text-gray-600 transition-colors dark:text-gray-400"
									href="/contact">Report bug</a
								>
							</li>
							<li>
								<a
									class="hover:text-brand-600 dark:hover:text-brand-400 text-gray-600 transition-colors dark:text-gray-400"
									href="/contact">Feature request</a
								>
							</li>
						</ul>
					</div>
				</div>

				<!-- Footer bottom -->
				<div
					class="footer__bottom flex flex-col items-center justify-between gap-4 border-t border-gray-200 py-6 sm:flex-row dark:border-gray-700"
				>
					<p class="text-sm text-gray-600 dark:text-gray-400">
						&copy; {year} FusionCore Apps. All rights reserved.
					</p>
					<div class="flex items-center gap-6 text-sm text-gray-600 dark:text-gray-400">
						<a
							class="hover:text-brand-600 dark:hover:text-brand-400 transition-colors"
							href="/privacy">Privacy</a
						>
						<a
							class="hover:text-brand-600 dark:hover:text-brand-400 transition-colors"
							href="/contact">Terms</a
						>
					</div>
				</div>
			</div>
		</footer>

		<!-- Mobile menu toggle script -->
		<script is:inline>
			document.addEventListener("astro:page-load", async () => {
				const mobileMenuButton = document.getElementById("mobile-menu-button");
				const mobileMenu = document.getElementById("mobile-menu");

				if (mobileMenuButton && mobileMenu) {
					mobileMenuButton.addEventListener("click", function () {
						mobileMenu.classList.toggle("hidden");
						const isExpanded = !mobileMenu.classList.contains("hidden");
						mobileMenuButton.setAttribute("aria-expanded", isExpanded.toString());
					});
				}
			});
		</script>
	</body>
</html>
