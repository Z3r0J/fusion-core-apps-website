---
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import { ArrowRight, Star } from "lucide-react";
import PlaceholderApp from "@/assets/placeholder-app.svg";
const { app, featured = false } = Astro.props as {
	app: CollectionEntry<"apps">;
	featured?: boolean;
};

// Extract rating if available (default values since they're not in the frontmatter)
const rating = 4.5; // Default rating
const downloads = "1K+"; // Default downloads
const price = app.data.price || "Free";
---

<article
	class:list={[
		`app-card card card--elevated group transition-all duration-300 hover:scale-105`,
		{ "app-card--featured": featured },
	]}
>
	<a aria-label={`${app.data.title} app`} class="app-card__link block" href={`/apps/${app.slug}`}>
		<!-- App Icon & Badge -->
		<div class="app-card__header relative p-6 pb-4">
			<div class="flex items-start gap-4">
				<!-- App Icon -->
				<div class="app-card__icon-wrapper relative flex-shrink-0">
					{
						app.data.icon ? (
							<Image
								alt={`${app.data.title} app icon`}
								class="app-card__icon h-16 w-16 rounded-2xl shadow-lg transition-shadow duration-300 group-hover:shadow-xl"
								height={64}
								loading="lazy"
								src={app.data.icon}
								width={64}
							/>
						) : (
							<PlaceholderApp class="app-card__icon h-16 w-16 rounded-2xl shadow-lg transition-shadow duration-300 group-hover:shadow-xl" />
						)
					}

					{
						featured && (
							<div class="absolute -top-2 -right-2 flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-yellow-400 to-yellow-500 shadow-lg">
								<Star className="h-3 w-3 text-white" fill="currentColor" />
							</div>
						)
					}
				</div>

				<!-- App Info -->
				<div class="app-card__info min-w-0 flex-1">
					<h3
						class="app-card__title group-hover:text-brand-600 dark:group-hover:text-brand-400 truncate text-lg font-bold text-gray-900 transition-colors duration-200 dark:text-white"
					>
						{app.data.title}
					</h3>
					<p class="app-card__tagline mt-1 line-clamp-2 text-sm text-gray-600 dark:text-gray-400">
						{app.data.tagline}
					</p>

					<!-- Rating & Downloads -->
					<div class="app-card__meta mt-3 flex items-center gap-4">
						<div class="flex items-center gap-1">
							<div class="flex items-center">
								{
									Array.from({ length: 5 }).map((_, i) => (
										<Star
											className={`h-3 w-3 ${i < Math.floor(rating) ? "text-yellow-400" : "text-gray-300 dark:text-gray-600"}`}
											fill="currentColor"
										/>
									))
								}
							</div>
							<span class="ml-1 text-xs text-gray-500 dark:text-gray-400">{rating}</span>
						</div>

						<div class="text-xs text-gray-500 dark:text-gray-400">
							{downloads}
						</div>
					</div>
				</div>

				<!-- Price Badge -->
				<div class="app-card__price">
					<span
						class:list={[
							`inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium`,
							{
								"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":
									price === "Free",
								"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":
									price !== "Free",
							},
						]}
					>
						{price}
					</span>
				</div>
			</div>
		</div>

		<!-- App Description -->
		<div class="app-card__body px-6 pb-4">
			<p
				class="app-card__description line-clamp-3 text-sm leading-relaxed text-gray-700 dark:text-gray-300"
			>
				{app.data.description}
			</p>
		</div>

		<!-- App Footer -->
		<div class="app-card__footer px-6 pb-6">
			<div class="flex items-center justify-between">
				<!-- Category -->
				<span
					class="app-card__category inline-flex items-center rounded-full bg-gray-100 px-3 py-1 text-xs font-medium text-gray-700 dark:bg-gray-800 dark:text-gray-300"
				>
					{app.data.category}
				</span>

				<!-- Download CTA -->
				<div
					class="app-card__cta text-brand-600 dark:text-brand-400 group-hover:text-brand-700 dark:group-hover:text-brand-300 flex items-center text-sm font-medium transition-colors"
				>
					<span>Download</span>

					<ArrowRight className="ml-1 h-4 w-4 transition-transform group-hover:translate-x-1" />
				</div>
			</div>
		</div>
	</a>
</article>

<style>
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	.line-clamp-3 {
		display: -webkit-box;
		-webkit-line-clamp: 3;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
</style>
